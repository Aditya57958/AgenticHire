{
    "sourceFile": "backend/main.py",
    "activeCommit": 0,
    "commits": [
        {
            "activePatchIndex": 9,
            "patches": [
                {
                    "date": 1765095923279,
                    "content": "Index: \n===================================================================\n--- \n+++ \n"
                },
                {
                    "date": 1765095949919,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -3,12 +3,12 @@\n from fastapi.responses import JSONResponse, FileResponse\n from fastapi.staticfiles import StaticFiles\n from typing import Optional\n from dotenv import load_dotenv\n-from .utils import extract_text_from_pdf_bytes, scrape_job_description, _latin1_safe, compute_ats_analysis, compute_resume_optimization, get_ats_resume_templates\n-from .agents import generate_hr_email, generate_interview_questions, modify_resume, generate_resume_pdf\n-from .llm import get_llm, llm_generate_hr_email, llm_generate_questions, llm_modify_resume\n-from .crewai_pipeline import run_crewai\n+from utils import extract_text_from_pdf_bytes, scrape_job_description, _latin1_safe, compute_ats_analysis, compute_resume_optimization, get_ats_resume_templates\n+from agents import generate_hr_email, generate_interview_questions, modify_resume, generate_resume_pdf\n+from llm import get_llm, llm_generate_hr_email, llm_generate_questions, llm_modify_resume\n+from crewai_pipeline import run_crewai\n \n from fastapi.middleware.cors import CORSMiddleware\n from starlette.middleware.base import BaseHTTPMiddleware\n from starlette.responses import Response\n"
                },
                {
                    "date": 1765096089975,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -41,9 +41,9 @@\n def health():\n     return {\"status\": \"ok\"}\n \n @app.post(\"/process\")\n-async def process(step: str = Form(...), resume: Optional[UploadFile] = None, job_link: Optional[str] = Form(None), applicant_name: Optional[str] = Form(\"Applicant\"), use_crewai: Optional[str] = Form(None)):\n+async def process(step: str = Form(...), resume: Optional[UploadFile] = None, resume_text: Optional[str] = Form(None), job_link: Optional[str] = Form(None), applicant_name: Optional[str] = Form(\"Applicant\"), use_crewai: Optional[str] = Form(None)):\n     if step == \"ats_analysis\":\n         if not resume or not job_link:\n             return JSONResponse({\"error\": \"Resume and Job Link are required for ATS Analysis step.\"}, status_code=400)\n         pdf_bytes = await resume.read()\n"
                },
                {
                    "date": 1765096096812,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -73,12 +73,15 @@\n         if \"error\" in templates_result:\n             return JSONResponse(templates_result, status_code=400)\n         return JSONResponse(templates_result)\n     elif step == \"full_process\":\n-        if not resume or not job_link:\n-            return JSONResponse({\"error\": \"Resume and Job Link are required for Full Process step.\"}, status_code=400)\n-        pdf_bytes = await resume.read()\n-        resume_text = extract_text_from_pdf_bytes(pdf_bytes)\n+        if not job_link or (not resume and not resume_text):\n+            return JSONResponse({\"error\": \"Resume (file or text) and Job Link are required for Full Process step.\"}, status_code=400)\n+        if resume:\n+            pdf_bytes = await resume.read()\n+            resume_content = extract_text_from_pdf_bytes(pdf_bytes)\n+        elif resume_text:\n+            resume_content = resume_text\n         jd_text = scrape_job_description(job_link)\n         try:\n             if (use_crewai or \"\").lower() in (\"1\",\"true\",\"yes\"):\n                 outputs = run_crewai(applicant_name or \"Applicant\", jd_text, resume_text)\n"
                },
                {
                    "date": 1765096104330,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -83,9 +83,9 @@\n             resume_content = resume_text\n         jd_text = scrape_job_description(job_link)\n         try:\n             if (use_crewai or \"\").lower() in (\"1\",\"true\",\"yes\"):\n-                outputs = run_crewai(applicant_name or \"Applicant\", jd_text, resume_text)\n+                outputs = run_crewai(applicant_name or \"Applicant\", jd_text, resume_content)\n                 email = outputs.get(\"email\") or outputs.get(\"result\") or \"\"\n                 questions = outputs.get(\"questions\") or []\n                 modified_text = outputs.get(\"resume\") or outputs.get(\"result\") or \"\"\n             else:\n"
                },
                {
                    "date": 1765096110462,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -89,11 +89,11 @@\n                 questions = outputs.get(\"questions\") or []\n                 modified_text = outputs.get(\"resume\") or outputs.get(\"result\") or \"\"\n             else:\n                 llm = get_llm()\n-                email = llm_generate_hr_email(llm, applicant_name or \"Applicant\", jd_text, resume_text)\n+                email = llm_generate_hr_email(llm, applicant_name or \"Applicant\", jd_text, resume_content)\n                 questions = llm_generate_questions(llm, jd_text)\n-                modified_text = llm_modify_resume(llm, resume_text, jd_text)\n+                modified_text = llm_modify_resume(llm, resume_content, jd_text)\n             warning = None\n         except Exception as e:\n             email = generate_hr_email(applicant_name or \"Applicant\", jd_text, resume_text)\n             questions = generate_interview_questions(jd_text)\n"
                },
                {
                    "date": 1765096116585,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -94,11 +94,11 @@\n                 questions = llm_generate_questions(llm, jd_text)\n                 modified_text = llm_modify_resume(llm, resume_content, jd_text)\n             warning = None\n         except Exception as e:\n-            email = generate_hr_email(applicant_name or \"Applicant\", jd_text, resume_text)\n+            email = generate_hr_email(applicant_name or \"Applicant\", jd_text, resume_content)\n             questions = generate_interview_questions(jd_text)\n-            modified_text = modify_resume(resume_text, jd_text)\n+            modified_text = modify_resume(resume_content, jd_text)\n             warning = f\"LLM pipeline failed, used heuristic fallback: {type(e).__name__}\"\n         pdf_bytes = generate_resume_pdf(_latin1_safe(modified_text))\n         pdf_b64 = base64.b64encode(pdf_bytes).decode(\"ascii\")\n         return JSONResponse({\n"
                },
                {
                    "date": 1765096141848,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -43,15 +43,18 @@\n \n @app.post(\"/process\")\n async def process(step: str = Form(...), resume: Optional[UploadFile] = None, resume_text: Optional[str] = Form(None), job_link: Optional[str] = Form(None), applicant_name: Optional[str] = Form(\"Applicant\"), use_crewai: Optional[str] = Form(None)):\n     if step == \"ats_analysis\":\n-        if not resume or not job_link:\n-            return JSONResponse({\"error\": \"Resume and Job Link are required for ATS Analysis step.\"}, status_code=400)\n-        pdf_bytes = await resume.read()\n-        resume_text = extract_text_from_pdf_bytes(pdf_bytes)\n+        if not job_link or (not resume and not resume_text):\n+            return JSONResponse({\"error\": \"Resume (file or text) and Job Link are required for ATS Analysis step.\"}, status_code=400)\n+        if resume:\n+            pdf_bytes = await resume.read()\n+            resume_content = extract_text_from_pdf_bytes(pdf_bytes)\n+        elif resume_text:\n+            resume_content = resume_text\n         jd_text = scrape_job_description(job_link)\n         # Run real ATS analysis\n-        ats_result = compute_ats_analysis(resume_text, jd_text)\n+        ats_result = compute_ats_analysis(resume_content, jd_text)\n         if \"error\" in ats_result:\n             return JSONResponse(ats_result, status_code=400)\n         return JSONResponse({\n             **ats_result,\n"
                },
                {
                    "date": 1765096148647,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -60,15 +60,18 @@\n             **ats_result,\n             \"options\": [\"Resume Optimization\", \"Mail for HR\"]\n         })\n     elif step == \"resume_optimization\":\n-        if not resume or not job_link:\n-            return JSONResponse({\"error\": \"Resume and Job Link are required for Resume Optimization step.\"}, status_code=400)\n-        pdf_bytes = await resume.read()\n-        resume_text = extract_text_from_pdf_bytes(pdf_bytes)\n+        if not job_link or (not resume and not resume_text):\n+            return JSONResponse({\"error\": \"Resume (file or text) and Job Link are required for Resume Optimization step.\"}, status_code=400)\n+        if resume:\n+            pdf_bytes = await resume.read()\n+            resume_content = extract_text_from_pdf_bytes(pdf_bytes)\n+        elif resume_text:\n+            resume_content = resume_text\n         jd_text = scrape_job_description(job_link)\n         # Run real resume optimization\n-        optimization_result = compute_resume_optimization(resume_text, jd_text)\n+        optimization_result = compute_resume_optimization(resume_content, jd_text)\n         if \"error\" in optimization_result:\n             return JSONResponse(optimization_result, status_code=400)\n         return JSONResponse(optimization_result)\n     elif step == \"ats_templates\":\n"
                },
                {
                    "date": 1765097116047,
                    "content": "Index: \n===================================================================\n--- \n+++ \n@@ -13,16 +13,8 @@\n from starlette.middleware.base import BaseHTTPMiddleware\n from starlette.responses import Response\n from starlette.types import ASGIApp\n \n-class NoCacheMiddleware(BaseHTTPMiddleware):\n-    async def dispatch(self, request, call_next):\n-        response = await call_next(request)\n-        response.headers[\"Cache-Control\"] = \"no-store, no-cache, must-revalidate, proxy-revalidate\"\n-        response.headers[\"Pragma\"] = \"no-cache\"\n-        response.headers[\"Expires\"] = \"0\"\n-        return response\n-\n load_dotenv()\n app = FastAPI(title=\"AgenticHire\")\n \n app.add_middleware(\n@@ -32,12 +24,8 @@\n     allow_methods=[\"*\"],  # Allows all methods\n     allow_headers=[\"*\"],  # Allows all headers\n )\n \n-app.add_middleware(NoCacheMiddleware)\n-\n-# app.mount(\"/\", StaticFiles(directory=\"new-frontend/dist\", html=True), name=\"new-frontend\")\n-\n @app.get(\"/health\")\n def health():\n     return {\"status\": \"ok\"}\n \n"
                }
            ],
            "date": 1765095923279,
            "name": "Commit-0",
            "content": "import base64\nfrom fastapi import FastAPI, UploadFile, Form\nfrom fastapi.responses import JSONResponse, FileResponse\nfrom fastapi.staticfiles import StaticFiles\nfrom typing import Optional\nfrom dotenv import load_dotenv\nfrom .utils import extract_text_from_pdf_bytes, scrape_job_description, _latin1_safe, compute_ats_analysis, compute_resume_optimization, get_ats_resume_templates\nfrom .agents import generate_hr_email, generate_interview_questions, modify_resume, generate_resume_pdf\nfrom .llm import get_llm, llm_generate_hr_email, llm_generate_questions, llm_modify_resume\nfrom .crewai_pipeline import run_crewai\n\nfrom fastapi.middleware.cors import CORSMiddleware\nfrom starlette.middleware.base import BaseHTTPMiddleware\nfrom starlette.responses import Response\nfrom starlette.types import ASGIApp\n\nclass NoCacheMiddleware(BaseHTTPMiddleware):\n    async def dispatch(self, request, call_next):\n        response = await call_next(request)\n        response.headers[\"Cache-Control\"] = \"no-store, no-cache, must-revalidate, proxy-revalidate\"\n        response.headers[\"Pragma\"] = \"no-cache\"\n        response.headers[\"Expires\"] = \"0\"\n        return response\n\nload_dotenv()\napp = FastAPI(title=\"AgenticHire\")\n\napp.add_middleware(\n    CORSMiddleware,\n    allow_origins=[\"*\"],  # Allows all origins\n    allow_credentials=True,\n    allow_methods=[\"*\"],  # Allows all methods\n    allow_headers=[\"*\"],  # Allows all headers\n)\n\napp.add_middleware(NoCacheMiddleware)\n\n# app.mount(\"/\", StaticFiles(directory=\"new-frontend/dist\", html=True), name=\"new-frontend\")\n\n@app.get(\"/health\")\ndef health():\n    return {\"status\": \"ok\"}\n\n@app.post(\"/process\")\nasync def process(step: str = Form(...), resume: Optional[UploadFile] = None, job_link: Optional[str] = Form(None), applicant_name: Optional[str] = Form(\"Applicant\"), use_crewai: Optional[str] = Form(None)):\n    if step == \"ats_analysis\":\n        if not resume or not job_link:\n            return JSONResponse({\"error\": \"Resume and Job Link are required for ATS Analysis step.\"}, status_code=400)\n        pdf_bytes = await resume.read()\n        resume_text = extract_text_from_pdf_bytes(pdf_bytes)\n        jd_text = scrape_job_description(job_link)\n        # Run real ATS analysis\n        ats_result = compute_ats_analysis(resume_text, jd_text)\n        if \"error\" in ats_result:\n            return JSONResponse(ats_result, status_code=400)\n        return JSONResponse({\n            **ats_result,\n            \"options\": [\"Resume Optimization\", \"Mail for HR\"]\n        })\n    elif step == \"resume_optimization\":\n        if not resume or not job_link:\n            return JSONResponse({\"error\": \"Resume and Job Link are required for Resume Optimization step.\"}, status_code=400)\n        pdf_bytes = await resume.read()\n        resume_text = extract_text_from_pdf_bytes(pdf_bytes)\n        jd_text = scrape_job_description(job_link)\n        # Run real resume optimization\n        optimization_result = compute_resume_optimization(resume_text, jd_text)\n        if \"error\" in optimization_result:\n            return JSONResponse(optimization_result, status_code=400)\n        return JSONResponse(optimization_result)\n    elif step == \"ats_templates\":\n        templates_result = get_ats_resume_templates()\n        if \"error\" in templates_result:\n            return JSONResponse(templates_result, status_code=400)\n        return JSONResponse(templates_result)\n    elif step == \"full_process\":\n        if not resume or not job_link:\n            return JSONResponse({\"error\": \"Resume and Job Link are required for Full Process step.\"}, status_code=400)\n        pdf_bytes = await resume.read()\n        resume_text = extract_text_from_pdf_bytes(pdf_bytes)\n        jd_text = scrape_job_description(job_link)\n        try:\n            if (use_crewai or \"\").lower() in (\"1\",\"true\",\"yes\"):\n                outputs = run_crewai(applicant_name or \"Applicant\", jd_text, resume_text)\n                email = outputs.get(\"email\") or outputs.get(\"result\") or \"\"\n                questions = outputs.get(\"questions\") or []\n                modified_text = outputs.get(\"resume\") or outputs.get(\"result\") or \"\"\n            else:\n                llm = get_llm()\n                email = llm_generate_hr_email(llm, applicant_name or \"Applicant\", jd_text, resume_text)\n                questions = llm_generate_questions(llm, jd_text)\n                modified_text = llm_modify_resume(llm, resume_text, jd_text)\n            warning = None\n        except Exception as e:\n            email = generate_hr_email(applicant_name or \"Applicant\", jd_text, resume_text)\n            questions = generate_interview_questions(jd_text)\n            modified_text = modify_resume(resume_text, jd_text)\n            warning = f\"LLM pipeline failed, used heuristic fallback: {type(e).__name__}\"\n        pdf_bytes = generate_resume_pdf(_latin1_safe(modified_text))\n        pdf_b64 = base64.b64encode(pdf_bytes).decode(\"ascii\")\n        return JSONResponse({\n            \"email\": email,\n            \"questions\": questions,\n            \"modified_resume_text\": modified_text,\n            \"modified_resume_pdf_base64\": pdf_b64,\n            \"warning\": warning\n        })\n    else:\n        return JSONResponse({\"error\": \"Invalid step provided.\"}, status_code=400)\n\n"
        }
    ]
}